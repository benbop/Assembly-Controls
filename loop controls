IDEAL
MODEL small
STACK 100h
DATASEG
; --------------------------

Y dw 100
X dw 100
Board dw 200
TIME_AUX DB 0
PressFlag db 0
SnakeBody dw 8
Xapple dw 80
yapple dw 80
; --------------------------
CODESEG
	


PROC moves
    MOV AH, 01h       ; Function 01h - Check for Key Press
    INT 16h
    JZ exit_moves     ; Jump if ZF is set (no key pressed)

    MOV AH, 00h       ; Function 00h - Read Key Stroke
    INT 16h

    ; Check if AH contains 'W' (ASCII value 87)
    CMP AL, 'w'
	je w_pressed
    
    ; Check if AH contains 'S' (ASCII value 83)
    CMP AL, 's'
    je s_pressed
    ; Check if AH contains 'D' (ASCII value 68)
    CMP AL, 'd'
    je d_pressed
    ; Check if AH contains 'A' (ASCII value 65)
    CMP AL, 'a'
    je a_pressed
    ; Check if AH contains '1B' (Escape key)
    

exit_moves:
    RET

ENDP moves

PROC w_pressed
    mov [PressFlag], 1
	SUB [Y], 5

    CHECK_TIME1:         ;time checking loop
    MOV AH,2Ch 					 ;get the system time
    INT 21h 			 ;is the current time equal to the previous one(TIME_AUX)?
    CMP DL,[TIME_AUX] 			 ;is the current time equal to the previous one(TIME_AUX)?

    JE CHECK_TIME1
    MOV [TIME_AUX],DL 

    CALL draw_player
	call moves
	CMP [PressFlag],1
    je w_pressed
    
	RET
ENDP w_pressed
d:
PROC d_pressed
    mov [PressFlag], 2
	ADD [X], 5

    CHECK_TIME2:          ;time checking loop
    MOV AH,2Ch 					 ;get the system time
    INT 21h 			 ;is the current time equal to the previous one(TIME_AUX)?
    CMP DL,[TIME_AUX] 			 ;is the current time equal to the previous one(TIME_AUX)?

    JE CHECK_TIME2
    MOV [TIME_AUX],DL 

    CALL draw_player
	call moves
	cmp [PressFlag],2
    je d_pressed
	ret
ENDP d_pressed
a:
PROC a_pressed
    mov [PressFlag], 3
	SUB [X], 5

    CHECK_TIME3:           ;time checking loop
    MOV AH,2Ch 					 ;get the system time
    INT 21h 			 ;is the current time equal to the previous one(TIME_AUX)?
    CMP DL,[TIME_AUX] 			 ;is the current time equal to the previous one(TIME_AUX)?

    JE CHECK_TIME3
    MOV [TIME_AUX],DL 

    CALL draw_player
	call moves
	CMP [PressFlag],3
    je a_pressed
	ret
ENDP a_pressed
s:
 PROC s_pressed
    ADD [Y], 5
    mov [PressFlag], 4
	

    CHECK_TIME4:           ;time checking loop
    MOV AH,2Ch 					 ;get the system time
    INT 21h 			 ;is the current time equal to the previous one(TIME_AUX)?
    CMP DL,[TIME_AUX] 			 ;is the current time equal to the previous one(TIME_AUX)?

    JE CHECK_TIME4
    MOV [TIME_AUX],DL 

    CALL draw_player
	call moves
	CMP [PressFlag],4
    je s_pressed
ENDP s_pressed

PROC draw_player
    MOV AX, 13h
    INT 10h
    
    MOV AX, 0C07h     ; Function 0Ch, Set Pixel Color
    MOV BH, 0         ; Page number (usually 0 in mode 13h)
    
    MOV CX, [X]       ; X-coordinate
    MOV DX, [Y]       ; Y-coordinate
    MOV SI, 0
    MOV DI, 0
    MOV AL, 2; Color green
    
    draw_row_loop:
	
        draw_pixel_loop:
		
            INC CX
            INC DI
            
            INT 10h
            CMP DI, 8
            JNE draw_pixel_loop
            
            SUB CX, 8
            MOV DI, 0
            INC DX
            INC SI
            
            CMP SI, [SnakeBody]
			
            JNE draw_row_loop
    call draw_apple
	
    RET
ENDP draw_player

PROC draw_apple
    
    
    MOV AX, 0C07h     ; Function 0Ch, Set Pixel Color
    MOV BH, 0         ; Page number (usually 0 in mode 13h)
    
    MOV CX, 50       ; X-coordinate
    MOV DX, 50       ; Y-coordinate
    MOV SI, [Xapple]
    MOV DI, [yapple]
    MOV AL, 2; Color red
	INT 10h
    
    
    RET
ENDP draw_apple
PROC game_logic
    CHECK_TIME:                      ;time checking loop
        MOV AH, 2Ch                  ;get the system time
        INT 21h                      ;is the current time equal to the previous one(TIME_AUX)?
        CMP DL, [TIME_AUX]           ;is the current time equal to the previous one(TIME_AUX)?

        JE CHECK_TIME                ;if it is the same, check again

        ; If it reaches this point, it's because the time has passed
        MOV [TIME_AUX], DL           ;update time
        CALL moves
        CALL draw_player
		
        

        RET

ENDP game_logic
MOV AX, 13h
INT 10h ; Set video mode 13h (320x200 pixels, 256 colors)

start:
    MOV AX, @data
    MOV DS, AX

    MOV AX, 13h
    INT 10h ; Set video mode 13h (320x200 pixels, 256 colors)

    game_loop:
	
    CALL game_logic
    JMP game_loop

exit:
    MOV AX, 4C00h
    INT 21h

END start
